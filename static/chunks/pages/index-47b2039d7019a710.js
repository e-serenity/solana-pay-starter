(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(8844)}])},8844:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return V}});var r=n(5893),a=n(7294),o=n(5287),c=n.n(o),s=n(4051),i=n.n(s),u=n(8155),l=n(2637),d=n(6938),p=n(444),f=function(e,t){return"https://gateway.ipfscdn.io/ipfs/".concat(e,"?filename=").concat(t)},h=function(e){var t=e.hash,n=e.filename,a=f(t,n);return(0,r.jsx)("div",{children:a?(0,r.jsx)("div",{className:"download-component",children:(0,r.jsx)("a",{className:"download-button",href:a,download:n,children:"Download"})}):(0,r.jsx)("p",{children:"Downloading file..."})})};function m(e,t,n,r,a,o,c){try{var s=e[o](c),i=s.value}catch(u){return void n(u)}s.done?t(i):Promise.resolve(i).then(r,a)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){m(o,r,a,c,s,"next",e)}function s(e){m(o,r,a,c,s,"throw",e)}c(void 0)}))}}var _=function(){var e=x(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("adding order ",t,"To DB"),e.next=3,fetch("../api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=x(i().mark((function e(t,n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("../api/orders?buyer=".concat(t.toString()));case 2:if(200!==(r=e.sent).status){e.next=12;break}return e.next=6,r.json();case 6:if(a=e.sent,console.log("Current wallet's orders are:",a),!(a.length>0)){e.next=12;break}if(!a.find((function(e){return e.buyer===t.toString()&&e.itemID===n}))){e.next=12;break}return e.abrupt("return",!0);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=x(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("../api/fetchItem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemID:t})});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=n(8764).Buffer;function g(e,t,n,r,a,o,c){try{var s=e[o](c),i=s.value}catch(u){return void n(u)}s.done?t(i):Promise.resolve(i).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){g(o,r,a,c,s,"next",e)}function s(e){g(o,r,a,c,s,"throw",e)}c(void 0)}))}}var w="Initial",P="Submitted",N="Paid";function S(e){var t=e.itemID,n=(0,d.Rc)().connection,o=(0,d.Os)(),c=o.publicKey,s=o.sendTransaction,f=(0,a.useMemo)((function(){return u.RG.generate().publicKey}),[]),m=(0,a.useState)(null),x=m[0],g=m[1],S=(0,a.useState)(!1),C=S[0],k=S[1],O=(0,a.useState)(w),T=O[0],D=O[1],I=(0,a.useMemo)((function(){return{buyer:c.toString(),orderID:f.toString(),itemID:t}}),[c,f,t]),E=function(){var e=b(i().mark((function e(){var t,r,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,fetch("../api/createTransaction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});case 3:return t=e.sent,e.next=6,t.json();case 6:return r=e.sent,a=u.YW.from(j.from(r.transaction,"base64")),console.log("Tx data is",a),e.prev=9,e.next=12,s(a,n);case 12:o=e.sent,console.log("Transaction sent: https://solscan.io/tx/".concat(o,"?cluster=devnet")),D(P),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(9),console.error(e.t0);case 20:return e.prev=20,k(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[9,17,20,23]])})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){function e(){return(e=b(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(c,t);case 2:if(!e.sent){e.next=9;break}return D(N),e.next=7,y(t);case 7:n=e.sent,g(n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[c,t]),(0,a.useEffect)((function(){if(T===P){k(!0);var e=setInterval(b(i().mark((function t(){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,l.f1)(n,f);case 3:r=t.sent,console.log("Finding tx reference",r.confirmationStatus),"confirmed"!==r.confirmationStatus&&"finalized"!==r.confirmationStatus||(clearInterval(e),D(N),_(I),k(!1),alert("Thank you for your purchase!")),t.next=13;break;case 8:if(t.prev=8,t.t0=t.catch(0),a=t.t0,!(null!=(o=l.Eb)&&"undefined"!==typeof Symbol&&o[Symbol.hasInstance]?o[Symbol.hasInstance](a):a instanceof o)){t.next=12;break}return t.abrupt("return",null);case 12:console.error("Unknown error",t.t0);case 13:return t.prev=13,k(!1),t.finish(13);case 16:case"end":return t.stop()}var a,o}),t,null,[[0,8,13,16]])}))),1e3);return function(){clearInterval(e)}}function r(){return(r=b(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:n=e.sent,g(n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}T===N&&function(e){r.apply(this,arguments)}(t)}),[T]),c?C?(0,r.jsx)(p.Nx,{color:"gray"}):(0,r.jsx)("div",{children:x?(0,r.jsx)(h,{hash:x.hash,filename:x.filename}):(0,r.jsx)("button",{disabled:C,className:"buy-button",onClick:E,children:"Buy now \ud83e\udc1a"})}):(0,r.jsx)("div",{children:(0,r.jsx)("p",{children:"You need to connect your wallet to make transactions"})})}function C(e){var t=e.product,n=t.id,a=t.name,o=t.price,s=t.description,i=t.image_url;return(0,r.jsxs)("div",{className:c().product_container,children:[(0,r.jsx)("div",{children:(0,r.jsx)("img",{className:c().product_image,src:i,alt:a})}),(0,r.jsxs)("div",{className:c().product_details,children:[(0,r.jsxs)("div",{className:c().product_text,children:[(0,r.jsx)("div",{className:c().product_title,children:a}),(0,r.jsx)("div",{className:c().product_description,children:s})]}),(0,r.jsxs)("div",{className:c().product_action,children:[(0,r.jsxs)("div",{className:c().product_price,children:[o," USDC"]}),(0,r.jsx)(S,{itemID:n})]})]})]})}var k=n(4400),O=n(6807),T=n.n(O);function D(e,t,n,r,a,o,c){try{var s=e[o](c),i=s.value}catch(u){return void n(u)}s.done?t(i):Promise.resolve(i).then(r,a)}function I(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){D(o,r,a,c,s,"next",e)}function s(e){D(o,r,a,c,s,"throw",e)}c(void 0)}))}}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){E(e,t,n[t])}))}return e}var B=(0,k.Ue)("https://ipfs.infura.io:5001/api/v0"),U=function(){var e=(0,a.useState)({name:"",price:"",image_url:"",description:""}),t=e[0],n=e[1],o=(0,a.useState)({}),c=o[0],s=o[1],u=(0,a.useState)(!1),l=u[0],d=u[1];function p(){return(p=I(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),n=t.target.files,e.prev=2,console.log(n[0]),e.next=6,B.add(n[0]);case 6:r=e.sent,s({filename:n[0].name,hash:r.path}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log("Error uploading file: ",e.t0);case 13:d(!1);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}var f=function(){var e=I(i().mark((function e(){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=A({},t,c),console.log("Sending product to api",n),e.next=5,fetch("../api/addProduct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 5:return r=e.sent,e.next=8,r.json();case 8:a=e.sent,200===r.status?alert("Product added!"):alert("Unable to add product: ",a.error),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return(0,r.jsx)("div",{className:T().background_blur,children:(0,r.jsx)("div",{className:T().create_product_container,children:(0,r.jsxs)("div",{className:T().create_product_form,children:[(0,r.jsx)("header",{className:T().header,children:(0,r.jsx)("h1",{children:"Create Product"})}),(0,r.jsxs)("div",{className:T().form_container,children:[(0,r.jsx)("input",{type:"file",className:T().input,accept:".zip,.rar,.7zip",placeholder:"Emojis",onChange:function(e){return p.apply(this,arguments)}}),null!=c.name&&(0,r.jsx)("p",{className:"file-name",children:c.filename}),(0,r.jsxs)("div",{className:T().flex_row,children:[(0,r.jsx)("input",{className:T().input,type:"text",placeholder:"Product Name",onChange:function(e){n(A({},t,{name:e.target.value}))}}),(0,r.jsx)("input",{className:T().input,type:"text",placeholder:"0.01 USDC",onChange:function(e){n(A({},t,{price:e.target.value}))}})]}),(0,r.jsx)("div",{className:T().flex_row,children:(0,r.jsx)("input",{className:T().input,type:"url",placeholder:"Image URL ex: https://i.imgur.com/rVD8bjt.png",onChange:function(e){n(A({},t,{image_url:e.target.value}))}})}),(0,r.jsx)("textarea",{className:T().text_area,placeholder:"Description here...",onChange:function(e){n(A({},t,{description:e.target.value}))}}),(0,r.jsx)("button",{className:T().button,onClick:function(){f()},disabled:l,children:"Create Product"})]})]})})})},R=n(9008),q=n.n(R);function z(){return(0,r.jsxs)(q(),{children:[(0,r.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"}),(0,r.jsx)("meta",{name:"theme-color",content:"#000000"}),(0,r.jsx)("title",{children:"Solana Pay Store"}),(0,r.jsx)("meta",{name:"title",content:"Solana Pay Store"}),(0,r.jsx)("meta",{name:"description",content:"Buy items on my store using Solana Pay!"}),(0,r.jsx)("meta",{property:"og:type",content:"website"}),(0,r.jsx)("meta",{property:"og:url",content:"https://buildspace.so/"}),(0,r.jsx)("meta",{property:"og:title",content:"Solana Pay Store"}),(0,r.jsx)("meta",{property:"og:description",content:"Buy items on my store using Solana Pay!"}),(0,r.jsx)("meta",{property:"og:image",content:"https://cdn.buildspace.so/courses/solana-pay/metadata.png"}),(0,r.jsx)("meta",{property:"twitter:card",content:"summary_large_image"}),(0,r.jsx)("meta",{property:"twitter:url",content:"https://buildspace.so/"}),(0,r.jsx)("meta",{property:"twitter:title",content:"Solana Pay Store"}),(0,r.jsx)("meta",{property:"twitter:description",content:"Buy items on my store using Solana Pay!"}),(0,r.jsx)("meta",{property:"twitter:image",content:"https://cdn.buildspace.so/courses/solana-pay/metadata.png"})]})}var G=n(8348),J="Crocodeal_Dev",K="https://twitter.com/".concat(J),V=function(){var e=(0,d.Os)().publicKey,t=!!e&&"EnAgw24ycRekUCbbE4yH815QdSytNVZVCrxXrm1mahBC"===e.toString(),n=(0,a.useState)(!1),o=n[0],c=n[1],s=(0,a.useState)([]),i=s[0],u=s[1];(0,a.useEffect)((function(){e&&fetch("/api/fetchProducts").then((function(e){return e.json()})).then((function(e){u(e),console.log("Products",e)}))}),[e]);return(0,r.jsxs)("div",{className:"App",children:[(0,r.jsx)(z,{}),(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("header",{className:"header-container",children:[(0,r.jsx)("p",{className:"header",children:" \ud83d\udc7e StarAtlas FAN store \ud83d\udc68\u200d\ud83d\ude80"}),(0,r.jsx)("p",{className:"sub-text",children:"The only store to to show you belong to a faction \ud83d\ude80"}),(0,r.jsx)("img",{src:"https://media.tenor.com/cqwXHGQYRV4AAAAd/star-atlas.gif",alt:"emoji"}),t&&(0,r.jsx)("button",{className:"create-product-button",onClick:function(){return c(!o)},children:o?"Close":"Create Product"})]}),(0,r.jsxs)("main",{children:[o&&(0,r.jsx)(U,{}),e?(0,r.jsx)("div",{className:"products-container",children:i.map((function(e){return(0,r.jsx)(C,{product:e},e.id)}))}):(0,r.jsx)("div",{className:"button-container",children:(0,r.jsx)(G.aD,{className:"cta-button connect-wallet-button"})})]}),(0,r.jsxs)("div",{className:"footer-container",children:[(0,r.jsx)("img",{alt:"Twitter Logo",className:"twitter-logo",src:"twitter-logo.svg"}),(0,r.jsx)("a",{className:"footer-text",href:K,target:"_blank",rel:"noreferrer",children:"built by @".concat(J)})]})]})]})}},6807:function(e){e.exports={background_blur:"CreateProduct_background_blur__8kqme",create_product_container:"CreateProduct_create_product_container__2OG8s",create_product_form:"CreateProduct_create_product_form__m8gs3",button:"CreateProduct_button__IrDqA","bg-pan-left":"CreateProduct_bg-pan-left__iKtGR",header:"CreateProduct_header__3lvqZ",form_container:"CreateProduct_form_container__58_z_",input:"CreateProduct_input__f2xnQ",flex_row:"CreateProduct_flex_row__ua2Pz",flex_full_row:"CreateProduct_flex_full_row__2lnVt",text_area:"CreateProduct_text_area__bF1av"}},5287:function(e){e.exports={product_container:"Product_product_container__iJuKc",product_image:"Product_product_image__qqLZh",product_details:"Product_product_details__B_XU1",product_text:"Product_product_text__R2de0",product_title:"Product_product_title__fxi1x",product_description:"Product_product_description__nuGaH",product_action:"Product_product_action__iNFpt",product_price:"Product_product_price__Qoijh"}},2611:function(){},8795:function(){}},function(e){e.O(0,[431,435,774,888,179],(function(){return t=5557,e(e.s=t);var t}));var t=e.O();_N_E=t}]);